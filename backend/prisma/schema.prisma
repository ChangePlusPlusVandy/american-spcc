generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum RESOURCE_TYPE {
  PDF
  TXT
  VIDEO
  WEBINAR
  WEBPAGE
  INTERACTIVE_QUIZ
  OTHER
}

enum HOSTING_TYPE {
  INTERNAL
  EXTERNAL
  OTHER
}

enum CATEGORY_TYPE {
  PARENTING_SKILLS_RELATIONSHIPS
  CHILD_DEVELOPMENT
  MENTAL_EMOTIONAL_HEALTH
  SAFETY_PROTECTION
  EDUCATION_LEARNING
  HEALTH_WELLBEING
  LIFE_SKILLS_INDEPENDENCE
  FAMILY_SUPPORT_COMMUNITY
}

enum AGE_GROUP {
  AGE_0_3
  AGE_4_6
  AGE_7_10
  AGE_10_13
  AGE_14_18
  AGE_18_ABOVE
}

enum LANGUAGE {
  ENGLISH
  SPANISH
  CHINESE
  OTHER
}

model CategoryLabel {
  id         String          @id @default(cuid())
  label_name String          @unique
  category   CATEGORY_TYPE
  resources  ResourceLabel[]

  @@map("categorylabel")
}

model Resource {
  id                String                   @id @default(cuid())
  title             String                   @unique
  description       String?
  resource_type     RESOURCE_TYPE
  hosting_type      HOSTING_TYPE
  category          CATEGORY_TYPE
  age_groups        AGE_GROUP[]
  language          LANGUAGE
  time_to_read      Int
  created_at        DateTime                 @default(now())
  updated_at        DateTime                 @updatedAt
  labels            ResourceLabel[]
  externalResources ExternalResources?
  collectionItems   CollectionItem[]
  internalResource  InternalHostedResources?
  image_s3_key  String? 

  @@map("resource")
}

model ResourceLabel {
  id          String        @id @default(cuid())
  resource_id String
  label_id    String
  resource    Resource      @relation(fields: [resource_id], references: [id])
  label       CategoryLabel @relation(fields: [label_id], references: [id])

  @@unique([resource_id, label_id])
  @@map("resourcelabel")
}

model ExternalResources {
  id           String   @id @default(cuid())
  resource_fk  String   @unique
  external_url String
  resource     Resource @relation(fields: [resource_fk], references: [id])

  @@map("externalResources")
}

enum RELATIONSHIP_TYPE {
  MOTHER
  FATHER
  GUARDIAN
  GRANDPARENT
  OTHER
  PREFER_NOT_TO_SAY
}

enum HOUSEHOLD_TYPE {
  MARRIED
  SINGLE_PARENT
  DIVORCED_SEPARATED
  WIDOWED
  OTHER
  PREFER_NOT_TO_SAY
}

model Parent {
  id         String @id @default(cuid())
  clerk_id   String @unique
  first_name String?
  last_name  String?
  email      String @unique

  relationship          RELATIONSHIP_TYPE?
  household_type        HOUSEHOLD_TYPE?
  topics_of_interest    CATEGORY_TYPE[]
  kids_age_groups       AGE_GROUP[]
  subscribed_newsletter Boolean            @default(false)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  onboarding_complete Boolean @default(false)


  collections   Collection[]
  @@map("parent")
}

model Collection {
  id         String   @id @default(cuid())
  parent_fk  String
  name       String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  parent  Parent            @relation(fields: [parent_fk], references: [id], onDelete: Cascade)
  items CollectionItem[]

  @@unique([parent_fk, name])
  @@map("collection")
}

model CollectionItem {
  id            String   @id @default(cuid())
  collection_fk String
  resource_fk   String
  created_at    DateTime @default(now())

  collection Collection @relation(fields: [collection_fk], references: [id], onDelete: Cascade)
  resource   Resource   @relation(fields: [resource_fk], references: [id], onDelete: Cascade)

  @@unique([collection_fk, resource_fk])
  @@map("collection_item")
}

model InternalHostedResources {
  id          String   @id @default(cuid())
  resource_fk String   @unique
  s3_key      String
  resource    Resource @relation(fields: [resource_fk], references: [id])

  @@map("internalHostedResources")
}


model AdminUser {
  id         String  @id @default(cuid())
  clerk_id   String  @unique
  email      String  @unique
  first_name String?
  last_name  String?
  is_active  Boolean @default(true)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  adminLogs AdminLog[]

  @@map("admin_user")
}

model AdminLog {
  id         String    @id @default(cuid())
  admin_fk   String
  admin      AdminUser @relation(fields: [admin_fk], references: [id], onDelete: Cascade)
  action     String
  details    String?
  created_at DateTime  @default(now())

  @@index([admin_fk])
  @@map("adminlog")
}